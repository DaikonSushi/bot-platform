# Bot-Platform æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ä»£ç å®¡æŸ¥æŠ¥å‘Š

## ðŸ“‹ ä»£ç å®¡æŸ¥ç»“æžœ

### âœ… ä»£ç æ­£ç¡®æ€§

ä½ çš„æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½å®žçŽ°æ˜¯**æ­£ç¡®çš„**ï¼ä»£ç ç»“æž„å®Œæ•´ï¼Œç¬¦åˆbot-platformçš„æž¶æž„è®¾è®¡ã€‚

### ðŸ“ æ¶‰åŠçš„æ–‡ä»¶

#### 1. Protobuf å®šä¹‰ (`api/proto/plugin.proto`)
- âœ… æ­£ç¡®å®šä¹‰äº† `UploadGroupFileRequest` æ¶ˆæ¯
- âœ… æ­£ç¡®å®šä¹‰äº† `UploadPrivateFileRequest` æ¶ˆæ¯  
- âœ… æ­£ç¡®å®šä¹‰äº† `UploadFileResponse` æ¶ˆæ¯
- âœ… åœ¨ `BotService` ä¸­æ·»åŠ äº†ä¸¤ä¸ªRPCæ–¹æ³•

#### 2. Bot æ ¸å¿ƒå®žçŽ° (`internal/bot/bot.go`)
- âœ… `UploadGroupFile()` - è°ƒç”¨ `upload_group_file` API
- âœ… `UploadPrivateFile()` - è°ƒç”¨ `upload_private_file` API
- âœ… å‚æ•°æ˜ å°„æ­£ç¡®ï¼ˆgroup_id, user_id, file, name, folderï¼‰

#### 3. gRPC æœåŠ¡å®žçŽ° (`internal/botservice/service.go`)
- âœ… `UploadGroupFile()` - å¤„ç†ç¾¤ç»„æ–‡ä»¶ä¸Šä¼ è¯·æ±‚
- âœ… `UploadPrivateFile()` - å¤„ç†ç§èŠæ–‡ä»¶ä¸Šä¼ è¯·æ±‚
- âœ… æ­£ç¡®çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•

#### 4. SDK å®¢æˆ·ç«¯ (`pkg/pluginsdk/sdk.go`)
- âœ… `UploadGroupFile()` - æ’ä»¶è°ƒç”¨æŽ¥å£
- âœ… `UploadPrivateFile()` - æ’ä»¶è°ƒç”¨æŽ¥å£
- âœ… æ”¯æŒå¯é€‰çš„ folder å‚æ•°ï¼ˆä½¿ç”¨å¯å˜å‚æ•°ï¼‰

### ðŸ” ä¸Ž NapCatQQ API çš„å¯¹æŽ¥

æ£€æŸ¥äº† NapCatQQ çš„å®žçŽ°ï¼Œç¡®è®¤ï¼š
- âœ… API action åç§°æ­£ç¡®ï¼š`upload_group_file` å’Œ `upload_private_file`
- âœ… å‚æ•°åç§°åŒ¹é…ï¼š`group_id`, `user_id`, `file`, `name`, `folder`
- âœ… NapCatQQ æ”¯æŒè¿™ä¸¤ä¸ª API

### ðŸŽ¯ ä»£ç äº®ç‚¹

1. **å®Œæ•´çš„é”™è¯¯å¤„ç†**ï¼šæ¯ä¸ªå±‚çº§éƒ½æœ‰é€‚å½“çš„é”™è¯¯å¤„ç†
2. **æ—¥å¿—è®°å½•**ï¼šåœ¨ service å±‚æ·»åŠ äº†è¯¦ç»†çš„æ—¥å¿—
3. **å¯é€‰å‚æ•°è®¾è®¡**ï¼šfolder å‚æ•°ä½¿ç”¨å¯å˜å‚æ•°ï¼Œä½¿ç”¨æ–¹ä¾¿
4. **æŽ¥å£ä¸€è‡´æ€§**ï¼šéµå¾ªäº† bot-platform çš„è®¾è®¡æ¨¡å¼

## ðŸ”§ ç¼–è¯‘çŠ¶æ€

### âœ… ç¼–è¯‘æˆåŠŸ

```bash
# 1. ç”Ÿæˆ protobuf ä»£ç 
protoc --go_out=. --go_opt=paths=source_relative \
  --go-grpc_out=. --go-grpc_opt=paths=source_relative \
  api/proto/plugin.proto

# 2. ç¼–è¯‘ bot-platform
make build
# ç»“æžœï¼šæˆåŠŸç”Ÿæˆ bot å¯æ‰§è¡Œæ–‡ä»¶

# 3. ç¼–è¯‘æµ‹è¯•æ’ä»¶
cd examples/plugin-filetest
go build -o filetest-plugin .
# ç»“æžœï¼šæˆåŠŸç”Ÿæˆ filetest-plugin å¯æ‰§è¡Œæ–‡ä»¶
```

## ðŸ§ª å¦‚ä½•æµ‹è¯•

### æ–¹æ³•ä¸€ï¼šä½¿ç”¨è‡ªåŠ¨æµ‹è¯•æ’ä»¶ï¼ˆæŽ¨èï¼‰

æˆ‘å·²ç»ä¸ºä½ åˆ›å»ºäº†ä¸€ä¸ªå®Œæ•´çš„æµ‹è¯•æ’ä»¶ï¼š`examples/plugin-filetest/`

#### 1. éƒ¨ç½²æµ‹è¯•æ’ä»¶

```bash
# å¤åˆ¶æ’ä»¶åˆ° plugins-bin ç›®å½•
cp examples/plugin-filetest/filetest-plugin plugins-bin/

# åˆ›å»ºæ’ä»¶é…ç½®
cat > plugins-config/filetest.json << EOF
{
  "name": "filetest",
  "enabled": true,
  "path": "./plugins-bin/filetest-plugin",
  "auto_start": true
}
EOF
```

#### 2. å¯åŠ¨ bot-platform

```bash
./bot
```

#### 3. æµ‹è¯•å‘½ä»¤

**è‡ªåŠ¨æµ‹è¯•ï¼ˆæœ€ç®€å•ï¼‰ï¼š**
```
/testfile
```
æ’ä»¶ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªæµ‹è¯•æ–‡ä»¶å¹¶ä¸Šä¼ åˆ°å½“å‰ä¼šè¯ã€‚

**æ‰‹åŠ¨æµ‹è¯•ç¾¤ç»„ä¸Šä¼ ï¼š**
```
/uploadgroup /tmp/test.txt
/uploadgroup /tmp/test.txt myfile.txt
/uploadgroup /tmp/test.txt myfile.txt /documents
```

**æ‰‹åŠ¨æµ‹è¯•ç§èŠä¸Šä¼ ï¼š**
```
/uploadprivate /tmp/test.txt
/uploadprivate /tmp/test.txt myfile.txt
```

### æ–¹æ³•äºŒï¼šä½¿ç”¨çŽ°æœ‰æ’ä»¶æµ‹è¯•

ä½ ä¹Ÿå¯ä»¥åœ¨ä»»ä½•çŽ°æœ‰æ’ä»¶ä¸­ä½¿ç”¨æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ï¼š

```go
// åœ¨ç¾¤ç»„ä¸­ä¸Šä¼ æ–‡ä»¶
err := bot.UploadGroupFile(groupID, "/path/to/file.txt", "display_name.txt")

// åœ¨ç¾¤ç»„ä¸­ä¸Šä¼ æ–‡ä»¶åˆ°æŒ‡å®šæ–‡ä»¶å¤¹
err := bot.UploadGroupFile(groupID, "/path/to/file.txt", "display_name.txt", "/documents")

// åœ¨ç§èŠä¸­ä¸Šä¼ æ–‡ä»¶
err := bot.UploadPrivateFile(userID, "/path/to/file.txt", "display_name.txt")
```

## ðŸ“ æµ‹è¯•æ£€æŸ¥æ¸…å•

- [ ] å¯åŠ¨ bot-platform æ— é”™è¯¯
- [ ] åŠ è½½ filetest æ’ä»¶æˆåŠŸ
- [ ] åœ¨ç¾¤ç»„ä¸­æ‰§è¡Œ `/testfile` å‘½ä»¤
- [ ] æ£€æŸ¥ç¾¤ç»„æ–‡ä»¶æ˜¯å¦æˆåŠŸä¸Šä¼ 
- [ ] åœ¨ç§èŠä¸­æ‰§è¡Œ `/testfile` å‘½ä»¤
- [ ] æ£€æŸ¥ç§èŠæ–‡ä»¶æ˜¯å¦æˆåŠŸæŽ¥æ”¶
- [ ] æµ‹è¯•æ‰‹åŠ¨æŒ‡å®šæ–‡ä»¶è·¯å¾„ä¸Šä¼ 
- [ ] æµ‹è¯•æŒ‡å®šæ–‡ä»¶å¤¹è·¯å¾„ï¼ˆç¾¤ç»„ï¼‰
- [ ] æµ‹è¯•é”™è¯¯æƒ…å†µï¼ˆæ–‡ä»¶ä¸å­˜åœ¨ï¼‰

## ðŸ› å¯èƒ½çš„é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

### é—®é¢˜1ï¼šæ–‡ä»¶è·¯å¾„æƒé™
**ç—‡çŠ¶**ï¼šä¸Šä¼ å¤±è´¥ï¼Œæç¤ºæ— æ³•è¯»å–æ–‡ä»¶
**è§£å†³**ï¼šç¡®ä¿ bot è¿›ç¨‹æœ‰æƒé™è¯»å–æŒ‡å®šçš„æ–‡ä»¶

### é—®é¢˜2ï¼šNapCatQQ æœªå¯åŠ¨
**ç—‡çŠ¶**ï¼šAPI è°ƒç”¨è¶…æ—¶æˆ–è¿žæŽ¥å¤±è´¥
**è§£å†³**ï¼šç¡®ä¿ NapCatQQ æ­£åœ¨è¿è¡Œå¹¶ä¸”é…ç½®æ­£ç¡®

### é—®é¢˜3ï¼šæ–‡ä»¶è¿‡å¤§
**ç—‡çŠ¶**ï¼šä¸Šä¼ è¶…æ—¶æˆ–å¤±è´¥
**è§£å†³**ï¼šQQ å¯¹æ–‡ä»¶å¤§å°æœ‰é™åˆ¶ï¼Œå»ºè®®æµ‹è¯•æ—¶ä½¿ç”¨å°æ–‡ä»¶

## ðŸ“Š ä»£ç è´¨é‡è¯„åˆ†

| é¡¹ç›® | è¯„åˆ† | è¯´æ˜Ž |
|------|------|------|
| åŠŸèƒ½å®Œæ•´æ€§ | â­â­â­â­â­ | å®Œæ•´å®žçŽ°äº†ç¾¤ç»„å’Œç§èŠæ–‡ä»¶ä¸Šä¼  |
| ä»£ç è§„èŒƒ | â­â­â­â­â­ | éµå¾ª Go å’Œ gRPC æœ€ä½³å®žè·µ |
| é”™è¯¯å¤„ç† | â­â­â­â­â­ | æ¯ä¸ªå±‚çº§éƒ½æœ‰é€‚å½“çš„é”™è¯¯å¤„ç† |
| æŽ¥å£è®¾è®¡ | â­â­â­â­â­ | ç®€æ´æ˜“ç”¨ï¼Œæ”¯æŒå¯é€‰å‚æ•° |
| æ–‡æ¡£å®Œæ•´æ€§ | â­â­â­â­â˜† | å»ºè®®æ·»åŠ æ›´å¤šæ³¨é‡Š |

## ðŸŽ‰ æ€»ç»“

ä½ çš„æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½å®žçŽ°æ˜¯**å®Œå…¨æ­£ç¡®çš„**ï¼ä»£ç å·²ç»æˆåŠŸç¼–è¯‘ï¼Œå¯ä»¥ç›´æŽ¥ä½¿ç”¨ã€‚

**ä¸‹ä¸€æ­¥å»ºè®®ï¼š**
1. ä½¿ç”¨æä¾›çš„æµ‹è¯•æ’ä»¶è¿›è¡ŒåŠŸèƒ½æµ‹è¯•
2. åœ¨å®žé™…åœºæ™¯ä¸­éªŒè¯æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½
3. æ ¹æ®æµ‹è¯•ç»“æžœè°ƒæ•´é”™è¯¯å¤„ç†é€»è¾‘
4. è€ƒè™‘æ·»åŠ æ–‡ä»¶å¤§å°æ£€æŸ¥å’Œç±»åž‹éªŒè¯

**å¿«é€Ÿå¼€å§‹æµ‹è¯•ï¼š**
```bash
# 1. å¯åŠ¨ bot-platform
cd /Users/hovanzhang/git_repo/napcat/bot-platform
./bot

# 2. åœ¨ QQ ä¸­å‘é€å‘½ä»¤
/testfile
```

ç¥æµ‹è¯•é¡ºåˆ©ï¼ðŸš€
